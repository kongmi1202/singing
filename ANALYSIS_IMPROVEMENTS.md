# ğŸµ ë¶„ì„ ë¡œì§ ê°œì„  ì‚¬í•­ (êµìœ¡ì  ìœ ì—°ì„± ê°•í™” ë²„ì „)

## ğŸ“‹ ê°œìš”
MIDI íŒŒì¼ì„ ì •ë‹µ ê¸°ì¤€ìœ¼ë¡œ ìœ ì§€í•˜ë©´ì„œ, ë¶„ì„ ë‹¨ê³„ì—ì„œ **êµìœ¡ì ìœ¼ë¡œ ìµœëŒ€í•œ ìœ ì—°í•œ** í‰ê°€ê°€ ê°€ëŠ¥í•˜ë„ë¡ ê°œì„ í–ˆìŠµë‹ˆë‹¤.  
ëª©í‘œ: **'ì˜ë„ì ì¸ í° ì˜¤ë¥˜'ë§Œ ì¡ì•„ë‚´ê³ , ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„ì€ ëª¨ë‘ í—ˆìš©**

---

## ğŸ¯ ì£¼ìš” ê°œì„  ì‚¬í•­ (ìµœì¢… ë²„ì „)

### 1. **ìŒê³ (Pitch) í—ˆìš© ì˜ì—­ - Â±75 Cent (ëŒ€í­ í™•ì¥ âœ¨)**
**ìœ„ì¹˜**: `src/analysis.js` (27ë²ˆ ì¤„, 190ë²ˆ ì¤„)

```javascript
const pitchToleranceSemis = 0.75  // Â±75 cents (êµìœ¡ì  í—ˆìš© ë²”ìœ„ í™•ì¥)
const tolCents = 75               // Â±75 Cent: ë°˜ìŒ(100 Cent)ì˜ 3/4
```

**íš¨ê³¼**:
- Â±75 Cent = ë°˜ìŒì˜ 3/4 ìˆ˜ì¤€ â†’ ì—¬ì „íˆ í‹€ë¦° ìŒì´ ì•„ë‹Œ ë²”ìœ„
- **ìì—°ìŠ¤ëŸ¬ìš´ ë¹„ë¸Œë¼í† **, ê°ì • í‘œí˜„ì— ì˜í•œ ìŒì • ë–¨ë¦¼ ì™„ì „ í—ˆìš©
- í•™ìƒì˜ ìì—°ìŠ¤ëŸ¬ìš´ ìŒì • ë¶ˆì•ˆì •ì„±ì„ ì˜¤ë¥˜ë¡œ íŒì •í•˜ì§€ ì•ŠìŒ
- ì‹¤ì œ í‹€ë¦° ìŒ(ë°˜ìŒ ì´ìƒ ì°¨ì´)ë§Œ ê°ì§€

---

### 2. **ë¦¬ë“¬(Rhythm) í—ˆìš© ì‹œê°„ - Â±150ms (ëŒ€í­ í™•ì¥ âœ¨)**
**ìœ„ì¹˜**: `src/analysis.js` (192ë²ˆ ì¤„)

```javascript
const tolMs = 150  // Â±150ms: ê°ì • í‘œí˜„ê³¼ í˜¸í¡ìœ¼ë¡œ ì¸í•œ ìì—°ìŠ¤ëŸ¬ìš´ ë°•ì ë°€ë¦¼ í—ˆìš©
const tolBeats = (tolMs / 1000) * (reference.tempoBpm / 60)  // ~0.3 beats @ 120BPM
```

**íš¨ê³¼**:
- 0.15ì´ˆì˜ íƒ€ì´ë° ì§€ì—°ê¹Œì§€ í—ˆìš©
- ê°ì •ì„ ì‚´ë¦¬ê¸° ìœ„í•œ **ë£¨ë°”í† (rubato)** í—ˆìš©
- í˜¸í¡ìœ¼ë¡œ ì¸í•œ ìì—°ìŠ¤ëŸ¬ìš´ ë°•ì ë°€ë¦¼ í—ˆìš©
- ì‹¬ê°í•œ ë¦¬ë“¬ ì˜¤ë¥˜ë§Œ ê°ì§€

---

### 3. **ë¶ˆì•ˆì • êµ¬ê°„ í•„í„°ë§ ê°•í™” (í•µì‹¬ ê°œì„  ğŸŒŸ)**

#### 3.1. ì¤‘ì•™ 60% êµ¬ê°„ë§Œ ì‚¬ìš© (ë”ìš± ê°•ë ¥í•œ í•„í„°ë§)
**ìœ„ì¹˜**: `src/analysis.js` (200-218ë²ˆ ì¤„, `buildNoteComparisons` í•¨ìˆ˜)

```javascript
// ğŸ¯ ê° ìŒí‘œì˜ ì‹œì‘/ë 20%ì”© ì œê±° â†’ ì¤‘ì•™ 60%ë§Œ ì‚¬ìš©
const margin = duration * 0.2  // ì‹œì‘/ë ê° 20% ì œê±°
const stableStart = start + margin
const stableEnd = end - margin

// ğŸ§  ì¤‘ì•™ê°’(Median) ì‚¬ìš©: ìˆœê°„ì  ìŠ¤íŒŒì´í¬ë‚˜ ë…¸ì´ì¦ˆì˜ ì˜í–¥ ìµœì†Œí™”
if (samples.length) {
  samples.sort((a,b)=>a-b)
  uMidi = samples[Math.floor(samples.length / 2)]
}
```

**íš¨ê³¼**:
- ìŒí‘œ ì‹œì‘ ì‹œ ë°œìƒí•˜ëŠ” **ì–´íƒ(attack)** êµ¬ê°„ì˜ ë¶ˆì•ˆì •í•œ í”¼ì¹˜ ì™„ì „ ì œê±°
- ìŒí‘œ ì „í™˜ ì‹œ ë°œìƒí•˜ëŠ” **í¬ë¥´íƒ€ë©˜í† (gliding)** êµ¬ê°„ ì™„ì „ ì œì™¸
- ìŒí‘œ ëì˜ **ë¦´ë¦¬ì¦ˆ(release)** êµ¬ê°„ ë¶ˆì•ˆì •ì„± ì œê±°
- **ê°€ì¥ ì•ˆì •ì ì¸ ì¤‘ì•™ ë¶€ë¶„ë§Œ** í‰ê°€ì— ì‚¬ìš©

---

#### 3.2. ì¤‘ì•™ê°’(Median) ê¸°ë°˜ í†µê³„ì  ì•ˆì •ì„± í™•ë³´
**ìœ„ì¹˜**: `src/analysis.js` (44-80ë²ˆ ì¤„, `analyzeAgainstReference` í•¨ìˆ˜)

```javascript
// ğŸ§  ì•ˆì • êµ¬ê°„ì˜ ì¤‘ì•™ê°’(Median)ìœ¼ë¡œ ì „ì²´ ìŒí‘œ êµ¬ê°„ì„ ëŒ€í‘œ
// í‰ê·  ëŒ€ì‹  ì¤‘ì•™ê°’ ì‚¬ìš©ìœ¼ë¡œ ì´ìƒì¹˜(outlier) ì˜í–¥ ìµœì†Œí™”
if (stableSamples.length > 0) {
  stableSamples.sort((a, b) => a - b)
  const stableMedian = stableSamples[Math.floor(stableSamples.length / 2)]
  // ìŒí‘œ ì „ì²´ êµ¬ê°„ì— ì•ˆì •ê°’ ì ìš©
  for (let i = noteStartIdx; i < noteEndIdx; i++) {
    if (userMidi[i] != null) {
      userMidi[i] = stableMedian
    }
  }
}
```

**íš¨ê³¼**:
- **í‰ê·  ëŒ€ì‹  ì¤‘ì•™ê°’** ì‚¬ìš©ìœ¼ë¡œ ìˆœê°„ì  ìŠ¤íŒŒì´í¬ ë¬´ì‹œ
- ì´ìƒì¹˜(outlier)ì˜ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ê²¬ê³ í•œ í†µê³„
- í•™ìƒì´ ìŒì •ì„ ìœ ì§€í•˜ë ¤ëŠ” **ì˜ë„**ë¥¼ ë” ì •í™•íˆ ë°˜ì˜
- ì¼ì‹œì  ëª©ì†Œë¦¬ ë–¨ë¦¼ì´ ì „ì²´ í‰ê°€ë¥¼ ì™œê³¡í•˜ì§€ ì•ŠìŒ

---

### 4. **ì˜¤ë””ì˜¤ ë¶„ì„ ê°œì„ **
**ìœ„ì¹˜**: `src/audio.js` (41-88ë²ˆ ì¤„)

#### 4.1. í”„ë ˆì„ í¬ê¸° í™•ëŒ€
```javascript
const frameSize = 8192  // 4096â†’8192: ë‚®ì€ ìŒë„ ì •í™•í•˜ê²Œ ê°ì§€
const hopSize = 512     // 256â†’512: ì‹œê°„ í•´ìƒë„ ìœ ì§€í•˜ë©´ì„œ ê³„ì‚° íš¨ìœ¨ í–¥ìƒ
```

**íš¨ê³¼**: ì €ìŒì—­ëŒ€ì˜ í”¼ì¹˜ ì¶”ì¶œ ì •í™•ë„ í–¥ìƒ

---

#### 4.2. YIN ì•Œê³ ë¦¬ì¦˜ ì„ê³„ê°’ ì¡°ì •
```javascript
const detector = Pitchfinder.YIN({ 
  sampleRate, 
  threshold: 0.15  // 0.1â†’0.15: ë” ì—„ê²©í•˜ê²Œ
})
```

**íš¨ê³¼**: ë…¸ì´ì¦ˆë¥¼ í”¼ì¹˜ë¡œ ì˜¤ì¸í•˜ëŠ” ì˜¤ë¥˜ ê°ì†Œ

---

#### 4.3. ì£¼íŒŒìˆ˜ ë²”ìœ„ í™•ì¥
```javascript
// C2(65Hz) ~ B5(988Hz) ë²”ìœ„ë¡œ í™•ì¥
if (freq < 65 || freq > 1000) freq = 0
```

**íš¨ê³¼**: ì•„ë™ë¶€í„° ì„±ì¸ê¹Œì§€ ì „ ìŒì—­ëŒ€ ì»¤ë²„

---

#### 4.4. RMS ê¸°ë°˜ ì‹ ë¢°ë„ ê³„ì‚°
```javascript
// ì‹ í˜¸ ê°•ë„(RMS) ê¸°ë°˜ ì‹ ë¢°ë„ ê³„ì‚°
let rms = 0
for (let j = 0; j < slice.length; j++) {
  rms += slice[j] * slice[j]
}
rms = Math.sqrt(rms / slice.length)
const conf = Math.min(1.0, rms * 10)

// ì‹ ë¢°ë„ê°€ ë„ˆë¬´ ë‚®ìœ¼ë©´ ë¬´ì„±ìŒìœ¼ë¡œ ì²˜ë¦¬
if (conf < 0.1) freq = 0
```

**íš¨ê³¼**: ì•½í•œ ì‹ í˜¸ êµ¬ê°„(ìˆ¨ì†Œë¦¬, ë¬´ì„±ìŒ ë“±)ì„ ìë™ í•„í„°ë§

---

## ğŸ“Š ê¸°ëŒ€ íš¨ê³¼

### Before (ì´ˆê¸° ë²„ì „)
- âŒ MIDIì˜ ì •í™•í•œ ìŒê³ /íƒ€ì´ë°ê³¼ë§Œ ë¹„êµ
- âŒ ì–´íƒ/í¬ë¥´íƒ€ë©˜í†  êµ¬ê°„ë„ ëª¨ë‘ í‰ê°€ì— í¬í•¨
- âŒ ë¯¸ì„¸í•œ ë–¨ë¦¼ë„ ì˜¤ë¥˜ë¡œ íŒì •
- âŒ ê³¼ë„í•˜ê²Œ ì—„ê²©í•œ í‰ê°€

### After v1 (1ì°¨ ê°œì„ )
- âš ï¸ Â±50 Cent, Â±100ms í—ˆìš© ë²”ìœ„ (ì—¬ì „íˆ ë‹¤ì†Œ ì—„ê²©)
- âš ï¸ ì¤‘ì•™ 70% êµ¬ê°„ ì‚¬ìš©
- âš ï¸ í‰ê· ê°’ ê¸°ë°˜ ë¶„ì„

### After v2 (ìµœì¢… ê°œì„  - í˜„ì¬ ë²„ì „ âœ¨)
- âœ… **Â±75 Cent, Â±150ms** í—ˆìš© ë²”ìœ„ë¡œ **ëŒ€í­ ì™„í™”**
- âœ… ë¶ˆì•ˆì •í•œ ì–´íƒ/í¬ë¥´íƒ€ë©˜í† /ë¦´ë¦¬ì¦ˆ êµ¬ê°„ ìë™ ì œì™¸
- âœ… ìŒí‘œì˜ **ì¤‘ì•™ 60%** ì•ˆì • êµ¬ê°„ë§Œ í‰ê°€ (ë”ìš± ê°•í™”)
- âœ… **ì¤‘ì•™ê°’(Median)** ê¸°ë°˜ í†µê³„ë¡œ ì´ìƒì¹˜ ì œê±°
- âœ… í•™ìŠµìì˜ ì‹¤ì œ ê°€ì°½ ëŠ¥ë ¥ì„ ë” ì •í™•í•˜ê²Œ ë°˜ì˜
- âœ… ìì—°ìŠ¤ëŸ¬ìš´ ì‚¬ëŒì˜ ë…¸ë˜ íŠ¹ì„±(ë¹„ë¸Œë¼í† , ë£¨ë°”í†  ë“±) ì™„ì „ í—ˆìš©
- âœ… **'ì˜ë„ì ì¸ í° ì˜¤ë¥˜'ë§Œ ê°ì§€**í•˜ëŠ” êµìœ¡ì  í‰ê°€

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê¶Œì¥ ì‚¬í•­

1. **ë‹¤ì–‘í•œ ìŒì—­ëŒ€ í…ŒìŠ¤íŠ¸**
   - ë‚®ì€ ìŒ(C2-C3)
   - ì¤‘ê°„ ìŒ(C3-C5)
   - ë†’ì€ ìŒ(C5-B5)

2. **íƒ€ì´ë° ë³€í™” í…ŒìŠ¤íŠ¸**
   - ë¹ ë¥¸ í…œí¬ (160+ BPM)
   - ëŠë¦° í…œí¬ (60-80 BPM)

3. **íŠ¹ìˆ˜ ìƒí™© í…ŒìŠ¤íŠ¸**
   - ì•½í•˜ê²Œ ë¶€ë¥´ê¸°
   - ê°•í•˜ê²Œ ë¶€ë¥´ê¸°
   - ë¹„ë¸Œë¼í†  í¬í•¨
   - ë¹ ë¥¸ ìŒí‘œ ì „í™˜

---

## ğŸ“ êµìœ¡ì  ì² í•™

### ì´ ì‹œìŠ¤í…œì˜ í‰ê°€ ê¸°ì¤€
1. **í‹€ë¦° ìŒ â‰  ë¶ˆì™„ì „í•œ ìŒ**: ë°˜ìŒ ì´ìƒ ë²—ì–´ë‚œ ê²ƒë§Œ 'í‹€ë¦° ìŒ'
2. **ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„ í—ˆìš©**: ë¹„ë¸Œë¼í† , ë£¨ë°”í†  ë“±ì€ ìŒì•…ì  í‘œí˜„
3. **ì˜ë„ë¥¼ í‰ê°€**: ìˆœê°„ì  ì‹¤ìˆ˜ë³´ë‹¤ ì „ì²´ì ì¸ ìŒì • ìœ ì§€ ëŠ¥ë ¥ í‰ê°€
4. **í•™ìŠµ ë™ê¸° ìœ ì§€**: ê³¼ë„í•œ ì˜¤ë¥˜ í‘œì‹œë¡œ í•™ìŠµ ì˜ìš• ì €í•˜ ë°©ì§€

### í˜„ì¬ ì„¤ì •ê°’ ê·¼ê±°
- **Â±75 Cent**: ë°˜ìŒ(100 Cent)ì˜ 3/4ë¡œ, í‹€ë¦° ìŒì´ ì•„ë‹ˆë©´ì„œ ìµœëŒ€í•œ ìœ ì—°
- **Â±150ms**: í‰ê·  ìŒí‘œ ê¸¸ì´(0.5ì´ˆ)ì˜ 30% ìˆ˜ì¤€ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ë³€í™” í—ˆìš©
- **ì¤‘ì•™ 60%**: ì–´íƒ/ë¦´ë¦¬ì¦ˆì˜ ë¶ˆì•ˆì •ì„±ì„ ìµœëŒ€í•œ ì œê±°
- **ì¤‘ì•™ê°’**: ì´ìƒì¹˜ì— ê°•ê±´í•œ í†µê³„ëŸ‰ìœ¼ë¡œ ì§„ì •í•œ ì˜ë„ íŒŒì•…

---

## ğŸ“ í–¥í›„ ê°œì„  ê°€ëŠ¥ ì‚¬í•­

1. **ì ì‘í˜• í—ˆìš© ë²”ìœ„**: í•™ìŠµìì˜ ìˆ™ë ¨ë„ì— ë”°ë¼ í—ˆìš© ë²”ìœ„ ë™ì  ì¡°ì •
2. **ë‚œì´ë„ ì„ íƒ**: ì´ˆê¸‰/ì¤‘ê¸‰/ê³ ê¸‰ ëª¨ë“œ ì œê³µ (í—ˆìš© ë²”ìœ„ ì¡°ì ˆ)
3. **ìŒëŸ‰ ê¸°ë°˜ ê°€ì¤‘ì¹˜**: ìŒëŸ‰ì´ í° êµ¬ê°„ì— ë” ë†’ì€ ê°€ì¤‘ì¹˜ ë¶€ì—¬
4. **ì‹¤ì‹œê°„ í”¼ë“œë°±**: ë¶„ì„ ì¤‘ì—ë„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¬¸ì œ êµ¬ê°„ í‘œì‹œ
5. **í‘œí˜„ë ¥ ì ìˆ˜**: ë¹„ë¸Œë¼í† , ë‹¤ì´ë‚˜ë¯¹ìŠ¤ ë“± ìŒì•…ì  í‘œí˜„ë ¥ ë³„ë„ í‰ê°€

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ
- **í”¼ì¹˜ ì¶”ì¶œ**: Pitchfinder (YIN ì•Œê³ ë¦¬ì¦˜)
- **ì‹ í˜¸ ì²˜ë¦¬**: Web Audio API
- **í•„í„°ë§**: Biquad Filter (HP 70Hz, LP 2kHz)
- **ìŠ¤ë¬´ë”©**: ì¤‘ì•™ê°’ í•„í„° + ì§€ìˆ˜ ì´ë™ í‰ê· (EMA)

